<!DOCTYPE html>
<html lang="ja">
<head>
  
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>管理画面 - otsuki-mart</title>
  <style>
    body {
      font-family: 'Noto Sans JP', sans-serif;
      margin: 20px;
      background: #f0f4fa;
      color: #333;
    }
    h1 {
      color: #007acc;
      margin-bottom: 1rem;
    }
    section {
      background: white;
      padding: 1rem;
      margin-bottom: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    h2 {
      color: #007acc;
      margin-bottom: 0.5rem;
    }
    textarea {
      width: 100%;
      font-size: 1rem;
      padding: 0.5rem;
      border-radius: 5px;
      border: 1px solid #ccc;
      resize: vertical;
      box-sizing: border-box;
    }
    button {
      margin-top: 0.8rem;
      padding: 0.6em 1.2em;
      background: linear-gradient(to right, #00c6ff, #0072ff);
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button:hover {
      background: linear-gradient(to right, #0072ff, #005bb5);
    }
    #save-message {
      margin-top: 1rem;
      font-weight: bold;
      color: green;
      height: 1.2em;
    }
  </style>
</head>
<body>
  <h1>管理画面</h1>

  <section>
    <h2>お知らせ編集</h2>
    <textarea id="news-input" rows="6" placeholder="お知らせを1行ずつ入力"></textarea>
    <button id="save-news">保存</button>
  </section>

  <section>
    <h2>店舗情報編集</h2>
    <textarea id="store-input" rows="4" placeholder="店舗情報を入力"></textarea>
    <button id="save-store">保存</button>
  </section>

  <section>
    <h2>社員情報編集</h2>
    <textarea id="staff-input" rows="8" placeholder="社員情報をCSV形式で入力&#10;例：氏名,役職,所属店舗"></textarea>
    <button id="save-staff">保存</button>
  </section>

  <p id="save-message"></p>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js"></script>

  <script>
    // Firebase設定
    const firebaseConfig = {
      apiKey: "AIzaSyBMhTeuoHLqZ1E0IRu7jfJcE9fvrZfAFgM",
      authDomain: "otsuki-mart.firebaseapp.com",
      databaseURL: "https://otsuki-mart-default-rtdb.firebaseio.com",
      projectId: "otsuki-mart",
      storageBucket: "otsuki-mart.firebasestorage.app",
      messagingSenderId: "970391222743",
      appId: "1:970391222743:web:81d6a31285c92da4a2f392",
      measurementId: "G-N7577RSBW6"
    };

    // Firebase初期化
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // データ読み込み
    function loadData() {
      return db.ref('/').get().then(snapshot => {
        if (snapshot.exists()) {
          return snapshot.val();
        } else {
          return {};
        }
      }).catch(() => {
        return {};
      });
    }

    // 管理画面の入力欄にデータセット
    async function loadDataForAdmin() {
      const data = await loadData();

      if (data.news) {
        document.getElementById('news-input').value = data.news.join('\n');
      }
      if (data.storeInfo) {
        document.getElementById('store-input').value = data.storeInfo;
      }
      if (data.staff) {
        const csv = data.staff.map(s => `${s.name},${s.position},${s.store}`).join('\n');
        document.getElementById('staff-input').value = csv;
      }
    }

    // 保存メッセージ表示
    function showSaveMessage(msg) {
      const p = document.getElementById('save-message');
      p.textContent = msg;
      setTimeout(() => { p.textContent = ''; }, 3000);
    }

    // 保存処理
    async function saveNews(text) {
      const newsArray = text.split(/\r?\n/).filter(l => l.trim() !== '');
      await db.ref('news').set(newsArray);
      showSaveMessage('お知らせを保存しました。');
    }

    async function saveStore(text) {
      await db.ref('storeInfo').set(text);
      showSaveMessage('店舗情報を保存しました。');
    }

    async function saveStaff(text) {
      const staffArray = text.split(/\r?\n/).map(line => {
        const parts = line.split(',');
        if(parts.length >= 3) {
          return { name: parts[0].trim(), position: parts[1].trim(), store: parts[2].trim() };
        } else {
          return null;
        }
      }).filter(Boolean);
      await db.ref('staff').set(staffArray);
      showSaveMessage('社員情報を保存しました。');
    }

    // ボタンイベント登録
    window.onload = () => {
      loadDataForAdmin();

      document.getElementById('save-news').onclick = async () => {
        const val = document.getElementById('news-input').value.trim();
        await saveNews(val);
      };
      document.getElementById('save-store').onclick = async () => {
        const val = document.getElementById('store-input').value.trim();
        await saveStore(val);
      };
      document.getElementById('save-staff').onclick = async () => {
        const val = document.getElementById('staff-input').value.trim();
        await saveStaff(val);
      };
    };
  </script>
</body>
</html>
